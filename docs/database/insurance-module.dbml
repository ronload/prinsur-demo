Project insurance_module {
    database_type: 'PostgreSQL'
    Note: '''
    ä¿éšªå•†å“ç®¡ç†æ¨¡çµ„
    åŒ…å«ï¼šä¿éšªå…¬å¸ã€ä¿éšªå•†å“ã€å•†å“è©³æƒ…ã€æ¨è–¦åƒæ•¸
    '''
}

//// ==========================================
//// ä¿éšªå•†å“ç®¡ç†æ¨¡çµ„ (Insurance Products)
//// ==========================================

//// ğŸ”¹ ä¿éšªå…¬å¸
Table companies [headercolor: #f39c12] {
    id         int         [pk, increment, note: 'GENERATED ALWAYS AS IDENTITY']
    name       varchar     [unique, not null]
    created_at timestamptz [default: `now()`]
    created_by int         [not null]
    updated_at timestamptz [default: `now()`]
    updated_by int         [not null]
    deleted_at timestamptz
    deleted_by int

    Note: 'ä¿éšªå…¬å¸ä¸»è¡¨'
}

//// ğŸ”¹ ä¿éšªå…¬å¸è©³ç´°è³‡è¨Š
Table company_details [headercolor: #f39c12] {
    company_id       int            [pk]
    paid_in_capital  numeric(14, 2) [note: 'å¯¦æ”¶è³‡æœ¬é¡']
    market_share     numeric(6, 3)  [note: 'å¸‚å ´ä½”æœ‰ç‡ (0.000-100.000)']
    insurance_income numeric(14, 2) [note: 'ä¿è²»æ”¶å…¥']
    updated_at       timestamptz    [default: `now()`]

    Note: 'ä¿éšªå…¬å¸è²¡å‹™èˆ‡å¸‚å ´è³‡è¨Š'
}
Ref: company_details.company_id - companies.id

//// ğŸ”¹ ä¿éšªå•†å“é¡åˆ¥
Enum insurance_categories {
    life
    health
    accident
    travel
    vehicle
    property
}

//// ğŸ”¹ ä¿éšªå•†å“ä¸»è¡¨
Table insurances [headercolor: #f39c12] {
    id         int                  [pk, increment, note: 'GENERATED ALWAYS AS IDENTITY']
    company_id int                  [not null]
    category   insurance_categories [not null]
    name       varchar              [not null]
    created_at timestamptz          [default: `now()`]
    created_by int                  [not null]
    updated_at timestamptz          [default: `now()`]
    updated_by int                  [not null]
    deleted_at timestamptz
    deleted_by int

    Indexes {
        category
        company_id
        (category, company_id)
    }

    Note: 'ä¿éšªå•†å“ä¸»è¡¨'
}
Ref: insurances.company_id > companies.id

//// ğŸ”¹ ä¿éšªå•†å“è©³ç´°è³‡è¨Š
Table insurance_details [headercolor: #f39c12] {
    insurance_id        int            [pk]
    available_age       varchar        [note: 'æŠ•ä¿å¹´é½¡ç¯„åœï¼ˆå¦‚ï¼š0-65æ­²ï¼‰']
    payment_period      varchar        [note: 'ç¹³è²»å¹´æœŸï¼ˆå¦‚ï¼š1å¹´ã€20å¹´ã€çµ‚èº«ï¼‰']
    is_renewable        boolean
    is_foreign_currency boolean        [note: 'æ˜¯å¦ç‚ºå¤–å¹£ä¿å–®']
    highest_pay         numeric(12, 2) [note: 'æœ€é«˜ä¿é¡']
    updated_at          timestamptz    [default: `now()`]

    Note: 'ä¿éšªå•†å“è©³ç´°è³‡è¨Š'
}
Ref: insurance_details.insurance_id - insurances.id [delete: cascade]

//// ğŸ”¹ ä¿éšªå•†å“æª”æ¡ˆ URLï¼ˆä¿å–®æ¢æ¬¾ã€DMï¼‰
Table insurance_file_urls [headercolor: #f39c12] {
    id           int  [pk, increment, note: 'GENERATED ALWAYS AS IDENTITY']
    insurance_id int  [not null]
    url          text [not null, note: 'ä¿å–®æ¢æ¬¾ã€DM é€£çµ']

    Indexes {
        insurance_id
        (insurance_id, url) [unique]
    }

    Note: 'ä¿éšªå•†å“ç›¸é—œæ–‡ä»¶ï¼ˆå¤šå°å¤šé—œä¿‚ï¼‰'
}
Ref: insurance_file_urls.insurance_id > insurances.id [delete: cascade]

//// ğŸ”¹ ä¿éšªä¿éšœé …ç›®
Table insurance_coverages [headercolor: #f39c12] {
    id           int  [pk, increment, note: 'GENERATED ALWAYS AS IDENTITY']
    insurance_id int  [not null]
    coverage     text [not null, note: 'ä¿éšœé …ç›®ï¼ˆå¦‚ï¼šèº«æ•…ã€å¤±èƒ½ã€ä½é™¢ï¼‰']

    Indexes {
        insurance_id
        (insurance_id, coverage) [unique]
    }

    Note: 'ä¿éšªä¿éšœé …ç›®ï¼ˆå¤šå°å¤šé—œä¿‚ï¼‰'
}
Ref: insurance_coverages.insurance_id > insurances.id [delete: cascade]

//// ğŸ”¹ ä¿éšªå•†å“æ¨™ç±¤ï¼ˆç”¨æ–¼åˆ†é¡èˆ‡æœå°‹ï¼‰
Table insurance_tags [headercolor: #f39c12] {
    id           int  [pk, increment, note: 'GENERATED ALWAYS AS IDENTITY']
    insurance_id int  [not null]
    tag          text [not null, note: 'æ¨™ç±¤ï¼ˆå¦‚ï¼šç†±é–€ã€é«˜CPå€¼ã€æ–°ä¸Šå¸‚ï¼‰']

    Indexes {
        insurance_id
        (insurance_id, tag) [unique]
    }

    Note: 'ä¿éšªå•†å“æ¨™ç±¤ï¼ˆå¤šå°å¤šé—œä¿‚ï¼‰'
}
Ref: insurance_tags.insurance_id > insurances.id [delete: cascade]

//// ğŸ”¹ ä¿éšªæ¨è–¦åƒæ•¸ï¼ˆç”¨æ–¼æ¼”ç®—æ³•æ’åºï¼‰
Table insurance_recommendation_params [headercolor: #f39c12] {
    insurance_id   int           [pk, not null]
    rating_score   numeric(2, 1) [not null, note: 'å¹³å‡è©•åˆ† 1.0-5.0']
    rating_count   int           [default: 0]
    view_count     int           [default: 0, note: 'ç€è¦½æ¬¡æ•¸']
    matching_count int           [default: 0, note: 'æ¨è–¦å‘½ä¸­æ¬¡æ•¸']

    Note: 'ä¿éšªæ¨è–¦æ¼”ç®—æ³•åƒæ•¸ï¼ˆè©•åˆ†ã€ç€è¦½æ•¸ã€æ¨è–¦æ¬¡æ•¸ï¼‰'
}
Ref: insurance_recommendation_params.insurance_id - insurances.id
