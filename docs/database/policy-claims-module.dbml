Project policy_claims_module {
    database_type: 'PostgreSQL'
    Note: '''
    ä¿å–®èˆ‡ç†è³ ç®¡ç†æ¨¡çµ„
    åŒ…å«ï¼šä¿å–®æŠ•ä¿ã€ç¹³è²»ç®¡ç†ã€ç†è³ ç”³è«‹ã€ç³»çµ±é€šçŸ¥
    '''
}

//// ==========================================
//// ä¿å–®èˆ‡ç†è³ ç®¡ç†æ¨¡çµ„ (Policy & Claims)
//// ==========================================

// å¼•ç”¨å…¶ä»–æ¨¡çµ„çš„ä¸»è¡¨ï¼ˆåƒ…é¡¯ç¤ºé—œè¯ï¼‰
Table customer_profiles [headercolor: #E8E8E8] {
    user_id int [pk]
    Note: 'ä¾†è‡ª profiles-module'
}

Table agent_profiles [headercolor: #E8E8E8] {
    user_id int [pk]
    Note: 'ä¾†è‡ª profiles-module'
}

Table insurances [headercolor: #E8E8E8] {
    id   int     [pk]
    name varchar
    Note: 'ä¾†è‡ª insurance-module'
}

Table users [headercolor: #E8E8E8] {
    id int [pk]
    Note: 'ä¾†è‡ª user-auth-module'
}

//// ğŸ”¹ ä¿å–®æŠ•ä¿ä¸»è¡¨
Table policy_enrollments [headercolor: #127859] {
    id            int         [pk, increment, note: 'GENERATED ALWAYS AS IDENTITY']
    customer_id   int         [not null]
    agent_id      int         [not null]
    insurance_id  int         [not null]
    policy_number text        [not null, unique, note: 'ä¿å–®è™Ÿç¢¼']
    created_at    timestamptz [default: `now()`]
    created_by    int         [not null]
    updated_at    timestamptz [default: `now()`]
    updated_by    int         [not null]
    deleted_at    timestamptz
    deleted_by    int

    Indexes {
        customer_id
        agent_id
        insurance_id
    }

    Note: 'ä¿å–®æŠ•ä¿è¨˜éŒ„ï¼ˆä¸‰æ–¹é—œä¿‚ï¼šå®¢æˆ¶ã€æ¥­å‹™å“¡ã€ä¿éšªå•†å“ï¼‰'
}
Ref: policy_enrollments.customer_id > customer_profiles.user_id [delete: restrict]
Ref: policy_enrollments.agent_id > agent_profiles.user_id [delete: restrict]
Ref: policy_enrollments.insurance_id > insurances.id [delete: restrict]

//// ğŸ”¹ ä¿å–®ç¹³è²»è©³æƒ…
Enum payment_frequency {
    monthly
    annually
    other
}

Table policy_enrollments_details [headercolor: #127859] {
    id                   int               [pk, increment, note: 'GENERATED ALWAYS AS IDENTITY']
    policy_enrollment_id int               [not null]
    transaction_date     timestamptz       [not null, note: 'äº¤æ˜“æ—¥æœŸ']
    insured_amount       numeric(12, 2)    [not null, note: 'ä¿éšœé‡‘é¡']
    start_date           timestamptz       [note: 'ä¿å–®ç”Ÿæ•ˆæ—¥']
    end_date             timestamptz       [note: 'ä¿å–®åˆ°æœŸæ—¥']
    payment_frequency    payment_frequency [not null]
    payment_amount       numeric(12, 2)    [not null, note: 'ç¹³è²»é‡‘é¡']
    next_due_date        timestamptz       [not null, note: 'ä¸‹æ¬¡ç¹³è²»æ—¥']
    is_active            boolean           [not null, note: 'æ˜¯å¦æœ‰æ•ˆ']

    Indexes {
        policy_enrollment_id
    }

    Note: 'ä¿å–®ç¹³è²»è©³æƒ…èˆ‡ç‹€æ…‹ç®¡ç†'
}
Ref: policy_enrollments_details.policy_enrollment_id - policy_enrollments.id

//// ğŸ”¹ ç†è³ ç”³è«‹
Enum claim_status {
    pending
    approved
    rejected
    processing
}

Table claims [headercolor: #127859] {
    id                   int            [pk, increment, note: 'GENERATED ALWAYS AS IDENTITY']
    policy_enrollment_id int            [not null]
    status               claim_status
    message              text           [note: 'ç†è³ èªªæ˜/æ‹’è³ åŸå› ']
    amount               numeric(12, 2) [note: 'ç†è³ é‡‘é¡']
    submit_date          timestamptz
    created_at           timestamptz    [default: `now()`]
    created_by           int            [not null]
    updated_at           timestamptz    [default: `now()`]
    updated_by           int            [not null]
    deleted_at           timestamptz
    deleted_by           int

    Note: 'ç†è³ ç”³è«‹èˆ‡è™•ç†ç‹€æ…‹'
}
Ref: claims.policy_enrollment_id - policy_enrollments.id

//// ğŸ”¹ ç†è³ é™„ä»¶ï¼ˆè¨ºæ–·è­‰æ˜ã€æ”¶æ“šç­‰ï¼‰
Table claim_attachments [headercolor: #127859] {
    id          int         [pk, increment]
    claim_id    int         [not null]
    file_url    text        [not null, note: 'æª”æ¡ˆå„²å­˜è·¯å¾‘/URL']
    file_name   varchar(255)
    uploaded_at timestamptz [default: `now()`]
    uploaded_by int         [not null]

    Note: 'ç†è³ ç”³è«‹é™„ä»¶ï¼ˆè¨ºæ–·è­‰æ˜ã€é†«ç™‚æ”¶æ“šç­‰ï¼‰'
}
Ref: claim_attachments.claim_id > claims.id

//// ğŸ”¹ ç³»çµ±é€šçŸ¥ï¼ˆåŒ…å«ç¹³è²»æé†’ï¼‰
Table notifications [headercolor: #A23456] {
    id         int         [pk, increment, note: 'GENERATED ALWAYS AS IDENTITY']
    user_id    int         [not null]
    title      text        [not null]
    payload    jsonb       [not null, note: 'JSON æ ¼å¼ï¼ŒåŒ…å«é€šçŸ¥è©³æƒ…']
    action_url text        [note: 'é»æ“Šå¾Œè·³è½‰çš„ URL']
    sent_at    timestamptz [not null, default: `now()`]
    read_at    timestamptz

    Indexes {
        (user_id, read_at)
    }

    Note: '''
    ç³»çµ±é€šçŸ¥ä¸­å¿ƒ
    payload ç¯„ä¾‹ï¼š
    {
      "type": "payment_reminder",
      "policy_name": "çµ‚èº«å£½éšª",
      "due_date": "2025-11-15",
      "amount": 12000
    }
    '''
}
Ref: notifications.user_id > users.id
