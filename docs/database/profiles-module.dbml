Project profiles_module {
    database_type: 'PostgreSQL'
    Note: '''
    å®¢æˆ¶èˆ‡æ¥­å‹™å“¡æª”æ¡ˆæ¨¡çµ„
    åŒ…å«ï¼šæ¶ˆè²»è€…æª”æ¡ˆã€ç—…å²ç®¡ç†ã€æ¥­å‹™å“¡æª”æ¡ˆã€æ¨è–¦åƒæ•¸
    '''
}

//// ==========================================
//// å®¢æˆ¶èˆ‡æ¥­å‹™å“¡æª”æ¡ˆæ¨¡çµ„ (User Profiles)
//// ==========================================

// å¼•ç”¨ä¸»è¡¨ï¼ˆåƒ…é¡¯ç¤ºé—œè¯ï¼‰
Table users [headercolor: #E8E8E8] {
    id   int [pk]
    name text
    Note: 'ä¾†è‡ª user-auth-module'
}

Enum gender {
    male
    female
}

//// ğŸ”¹ æ¶ˆè²»è€…æª”æ¡ˆ
Table customer_profiles [headercolor: #3498db] {
    user_id          int           [pk]
    age              int
    gender           gender
    weight_kg        numeric(5, 2)
    height_cm        numeric(5, 2)
    location_city    varchar
    occupation_level varchar
    created_at       timestamptz   [default: `now()`]
    created_by       int           [not null]
    updated_at       timestamptz   [default: `now()`]
    updated_by       int           [not null]
    deleted_at       timestamptz
    deleted_by       int

    Note: 'æ¶ˆè²»è€…åŸºæœ¬è³‡æ–™æª”æ¡ˆï¼Œç”¨æ–¼ä¿éšªæ¨è–¦'
}
Ref: customer_profiles.user_id - users.id [delete: cascade]

//// ğŸ”¹ ç—…å²åŠ å¯†å„²å­˜ï¼ˆAES-256-GCM + HMAC-SHA256ï¼‰
Table customer_medical_histories [headercolor: #3498db] {
    id                        int         [pk, increment, note: 'GENERATED ALWAYS AS IDENTITY']
    user_id                   int         [not null]

    // é†«ç™‚è³‡è¨ŠåŠ å¯†æ¬„ä½
    medical_history_encrypted bytea       [note: 'AES-256-GCM encrypted medical history']
    medical_history_iv        bytea       [note: 'Initialization Vector']
    medical_history_auth_tag  bytea       [note: 'Authentication Tag']
    encryption_key_id         varchar(50) [not null, note: 'Encryption key version']

    // å¯æœå°‹é›œæ¹Šï¼ˆç”¨æ–¼æŸ¥è©¢ç‰¹å®šç–¾ç—…ï¼‰
    condition_hash            varchar(64) [not null, note: 'HMAC-SHA256(user_id:condition)']

    created_at                timestamptz [default: `now()`]

    Indexes {
        user_id
        condition_hash
        (user_id, condition_hash) [unique]
    }

    Note: 'ç—…å²åŠ å¯†å„²å­˜ï¼Œæ”¯æ´ç‰¹å®šç–¾ç—…æŸ¥è©¢ï¼ˆå¦‚ï¼šç³–å°¿ç—…ã€é«˜è¡€å£“ï¼‰'
}
Ref: customer_medical_histories.user_id > customer_profiles.user_id

//// ğŸ”¹ æ¥­å‹™å“¡æª”æ¡ˆ
Table agent_profiles [headercolor: #e74c3c] {
    user_id        int         [pk]
    license_number varchar     [unique, not null, note: 'ä¿éšªæ¥­å‹™å“¡åŸ·ç…§è™Ÿç¢¼']
    company_id     int
    position       varchar
    address        varchar
    bio            text
    created_at     timestamptz [default: `now()`]
    created_by     int         [not null]
    updated_at     timestamptz [default: `now()`]
    updated_by     int         [not null]
    deleted_at     timestamptz
    deleted_by     int

    Indexes {
        company_id
    }

    Note: 'ä¿éšªæ¥­å‹™å“¡æª”æ¡ˆ'
}
Ref: agent_profiles.user_id - users.id [delete: cascade]

//// ğŸ”¹ æ¥­å‹™å“¡æœå‹™åœ°å€
Table agent_service_areas [headercolor: #e74c3c] {
    id           int  [pk, increment, note: 'GENERATED ALWAYS AS IDENTITY']
    user_id      int  [not null]
    service_area text [not null, note: 'æœå‹™åœ°å€ï¼ˆå¦‚ï¼šå°åŒ—å¸‚ã€æ–°åŒ—å¸‚ï¼‰']

    Indexes {
        user_id
        service_area
        (user_id, service_area) [unique]
    }

    Note: 'æ¥­å‹™å“¡æœå‹™åœ°å€ï¼ˆå¤šå°å¤šé—œä¿‚ï¼‰'
}
Ref: agent_service_areas.user_id > agent_profiles.user_id [delete: cascade]

//// ğŸ”¹ æ¥­å‹™å“¡å°ˆæ¥­é¡åˆ¥
Table agent_service_categories [headercolor: #e74c3c] {
    id               int  [pk, increment, note: 'GENERATED ALWAYS AS IDENTITY']
    user_id          int  [not null]
    service_category text [not null, note: 'å°ˆæ¥­é¡åˆ¥ï¼ˆå¦‚ï¼šå£½éšªã€å¥åº·éšªï¼‰']

    Indexes {
        user_id
        service_category
        (user_id, service_category) [unique]
    }

    Note: 'æ¥­å‹™å“¡å°ˆæ¥­é¡åˆ¥ï¼ˆå¤šå°å¤šé—œä¿‚ï¼‰'
}
Ref: agent_service_categories.user_id > agent_profiles.user_id [delete: cascade]

//// ğŸ”¹ æ¥­å‹™å“¡æ”¯æ´èªè¨€
Enum language {
    chinese
    taiwanese
    hakka
    english
}

Table agent_supported_languages [headercolor: #e74c3c] {
    id                 int      [pk, increment, note: 'GENERATED ALWAYS AS IDENTITY']
    user_id            int      [not null]
    supported_language language [not null]

    Indexes {
        user_id
        (user_id, supported_language) [unique]
    }

    Note: 'æ¥­å‹™å“¡æ”¯æ´èªè¨€ï¼ˆå¤šå°å¤šé—œä¿‚ï¼‰'
}
Ref: agent_supported_languages.user_id > agent_profiles.user_id

//// ğŸ”¹ æ¥­å‹™å“¡æ¨è–¦åƒæ•¸ï¼ˆç”¨æ–¼æ¼”ç®—æ³•æ’åºï¼‰
Table agent_recommendation_params {
    user_id      int           [pk, not null]
    rating_score numeric(2, 1) [note: 'å¹³å‡è©•åˆ† 1.0-5.0']
    rating_count int           [default: 0]
    view_count   int           [default: 0]

    Note: 'æ¥­å‹™å“¡æ¨è–¦æ¼”ç®—æ³•åƒæ•¸ï¼ˆè©•åˆ†ã€ç€è¦½æ•¸ï¼‰'
}
Ref: agent_recommendation_params.user_id > agent_profiles.user_id

//// ğŸ”¹ æ¥­å‹™å“¡èˆ‡å®¢æˆ¶é—œä¿‚
Table agent_customer_relations [headercolor: #95a5a6] {
    id          int         [pk, increment, note: 'GENERATED ALWAYS AS IDENTITY']
    customer_id int
    agent_id    int
    created_at  timestamptz [default: `now()`]

    Indexes {
        customer_id
        agent_id
    }

    Note: 'è¨˜éŒ„æ¥­å‹™å“¡æœå‹™éçš„å®¢æˆ¶ï¼ˆå¤šå°å¤šé—œä¿‚ï¼‰'
}
Ref: agent_customer_relations.customer_id > customer_profiles.user_id
Ref: agent_customer_relations.agent_id > agent_profiles.user_id

// ä¿éšªå…¬å¸ï¼ˆä¾†è‡ª insurance-moduleï¼‰
Table companies [headercolor: #E8E8E8] {
    id   int     [pk]
    name varchar
    Note: 'ä¾†è‡ª insurance-module'
}
Ref: agent_profiles.company_id > companies.id
